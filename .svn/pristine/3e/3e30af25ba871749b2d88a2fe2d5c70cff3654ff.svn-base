<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html lang="en" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light" data-menu-styles="dark" data-toggled="close">

<head>

    <!-- Meta Data -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> YNEX - Bootstrap 5 Premium Admin &amp; Dashboard Template </title>
    <meta name="Description" content="Bootstrap Responsive Admin Web Dashboard HTML5 Template">
    <meta name="Author" content="Spruko Technologies Private Limited">
	<meta name="keywords" content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit.">

   
<!-- Favicon -->
<link rel="icon"
	href="${pageContext.request.contextPath }/resources/assets/images/brand-logos/favicon.ico"
	type="image/x-icon">

<!-- Choices JS -->
<script
	src="${pageContext.request.contextPath }/resources/assets/libs/choices.js/public/assets/scripts/choices.min.js"></script>

<!-- Main Theme Js -->
<script
	src="${pageContext.request.contextPath }/resources/assets/js/main.js"></script>

<!-- Bootstrap Css -->
<link id="style"
	href="${pageContext.request.contextPath }/resources/assets/libs/bootstrap/css/bootstrap.min.css"
	rel="stylesheet">

<!-- Style Css -->
<link
	href="${pageContext.request.contextPath }/resources/assets/css/styles.min.css"
	rel="stylesheet">

<!-- Icons Css -->
<link
	href="${pageContext.request.contextPath }/resources/assets/css/icons.css"
	rel="stylesheet">

<!-- Node Waves Css -->
<link
	href="${pageContext.request.contextPath }/resources/assets/libs/node-waves/waves.min.css"
	rel="stylesheet">

<!-- Simplebar Css -->
<link
	href="${pageContext.request.contextPath }/resources/assets/libs/simplebar/simplebar.min.css"
	rel="stylesheet">

<!-- Color Picker Css -->
<link rel="stylesheet"
	href="${pageContext.request.contextPath }/resources/assets/libs/flatpickr/flatpickr.min.css">
<link rel="stylesheet"
	href="${pageContext.request.contextPath }/resources/assets/libs/@simonwep/pickr/themes/nano.min.css">

<!-- Choices Css -->
<link rel="stylesheet"
	href="${pageContext.request.contextPath }/resources/assets/libs/choices.js/public/assets/styles/choices.min.css">
	
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/assets/libs/dragula/dragula.min.css">

<!-- <link rel="stylesheet" href="${pageContext.request.contextPath }/resources/assets/libs/jsvectormap/css/jsvectormap.min.css">

<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/assets/libs/swiper/swiper-bundle.min.css"> -->


<!-- Prism CSS -->
<link rel="stylesheet"
	href="${pageContext.request.contextPath }/resources/assets/libs/prismjs/themes/prism-coy.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

</head>

<body>

<!-- Start::app-content -->
<div class="main-content app-content">
    <div class="container-fluid">
          <!-- Start::row-1 -->
          <div class="row">
              
              <h3>직원목록</h3>
              <div id="grid"></div>
                    
            </div>
      </div>
</div>
        <!-- End::app-content -->
 
	<!-- Popper JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/libs/@popperjs/core/umd/popper.min.js"></script>

	<!-- Bootstrap JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>

	<!-- Defaultmenu JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/defaultmenu.min.js"></script>

	<!-- Node Waves JS-->
	<script
		src="${pageContext.request.contextPath }/resources/assets/libs/node-waves/waves.min.js"></script>

	<!-- Sticky JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/sticky.js"></script>

	<!-- Simplebar JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/libs/simplebar/simplebar.min.js"></script>
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/simplebar.js"></script>



	<!-- Custom-Switcher JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/custom-switcher.min.js"></script>

	<!-- Prism JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/libs/prismjs/prism.js"></script>
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/prism-custom.js"></script>


	<!-- Custom JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/custom.js"></script>


	<!-- CRM-Dashboard -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/crm-dashboard.js"></script>
	
    <script src="${pageContext.request.contextPath }/resources/assets/libs/flatpickr/flatpickr.min.js"></script>


	<!-- Custom-Switcher JS -->
	<script
		src="${pageContext.request.contextPath }/resources/assets/js/custom-switcher.min.js"></script>

    <script src="${pageContext.request.contextPath }/resources/assets/libs/dragula/dragula.min.js"></script>
       <!-- Internal Task  JS -->
       <script src="${pageContext.request.contextPath }/resources/assets/js/task-kanban-board.js"></script>
</body>
<script type="text/javascript">

$(function(){
	 class CustomTextEditor {
	        constructor(props) {
	          const el = document.createElement('input');
	          const { maxLength } = props.columnInfo.editor.options;

	          el.type = 'text';
	          el.id = 'txt';
	          el.maxLength = maxLength;
	          el.value = String(props.value);

	          this.el = el;
	        }

	        getElement() {
	          return this.el;
	        }

	        getValue() {
	          return this.el.value;
	        }

	        mounted() {
	          this.el.select();
	        }
	      }
		//grid 인스턴스 생성
	      const grid = new tui.Grid({
	    	//gird가 생성될 컨테이너 HTML엘리먼트
	        el: document.getElementById('grid'),
	        
	        //페이징처리옵션
		     pageOptions: {
		     useClient: true,
		     perPage: 5,
		   },

//	         scrollX: false,
//	         scrollY: false,

			//헤더의 체크박스옵션
	        rowHeaders:['checkbox'],
	        //컬럼정보배열
	        columns: [
	            {
	                header: '사원번호',	//컬럼의 헤더에 사용
	                name: 'empNo',	//키값으로 사용됨
//	               editor: 'text',	//컬럼의 인풋타입 결정
	                sortable: true,		//정렬옵션
	                sortingType: 'asc',
	                	
	              },
	              {
		                header: '직무',
		                name: 'empJob',
		                editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,
		                sortingType: 'asc'
		              },
		          {
		                header: '이름',	//컬럼의 헤더에 사용
		                name: 'memName',	//키값으로 사용됨
//		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
			        {
		                header: '성별',	//컬럼의 헤더에 사용
		                name: 'memGender',	//키값으로 사용됨
//		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
		           {
		                header: '생년월일',	//컬럼의 헤더에 사용
		                name: 'memRegno1',	//키값으로 사용됨
//		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
		           {
		                header: '나이',	//컬럼의 헤더에 사용
		                name: 'memAge',	//키값으로 사용됨
//		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
		           {
		                header: '연락처',	//컬럼의 헤더에 사용
		                name: 'memTel',	//키값으로 사용됨
//		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
		           {
		                header: '주소',	//컬럼의 헤더에 사용
		                name: 'memAddress1',	//키값으로 사용됨
//		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
	              {
	                header: '면허번호',
	                name: 'empLicence',
	             	sortable: true,
	              	sortingType: 'asc',
	              	styles: {
	              		color: '#ccc'
	              	}
	              },
	              {
	                  header: '입사일',
	                  name: 'empHireDate',
	                  sortable: true,
	                  sortingType: 'asc',
// 	                   filter: 'date',
	                },
	 	           {
		                header: '퇴사여부',	//컬럼의 헤더에 사용
		                name: 'empLeave',	//키값으로 사용됨
// 		               editor: 'text',	//컬럼의 인풋타입 결정
		                sortable: true,		//정렬옵션
		                sortingType: 'asc',
		                	
		           },
		              {
		                  header: '퇴사일',
		                  name: 'empLeaveDate',
// 		                  editor: 'text'	//컬럼의 인풋타입 결정
// 		                  filter: 'date',
		               }

	        ]

	      });
	      //전체리스트 불러오기
	      showList();
	      
	      var data;
	      var empNo;
	      
	      grid.on('dblclick',function(){
			  grid.startEditing();
			  data = grid.getFocusedCell(); // 클릭한 셀 값
			  console.log("data  : "+data.rowKey);
			  let ob = grid.getColumnValues('empNo'); // empNo 배열
			  console.log("ob :"+ob);
			  let idx = data.rowKey; // 클릭한 셀 행 번호
			  empNo = ob[idx]; // 클릭한 셀 행번호에 해당하는 empNo 값
			  console.log(data);

	      grid.on('beforeChange', ev => {
//	         console.log('before change:', ev);
	      });
	      
	});
	      grid.on('afterChange', ev => {
	    	
			let changeData = ev.changes[0].value;
	        console.log('after change:', changeData);
	    	data.value = changeData;	//수정한 값을 담아줌
	    	
			let empData = {
					empNo : empNo,
// 					columnName : data.columnName,
					value : data.value
				};
			console.table(empData);
			
			
			$.ajax({
		   		url:"/empList/updateEmp",
	  			type:"post",
	  			contentType : "application/json;charset=utf-8",	//보내는거
	  			data : JSON.stringify(empData),	//보내는 데이터
	  			success:function(result){
	  				console.log("result: " + result);
	  				if(result ==="SUCCESS"){
	  					showList();
	  				}
	  			}
	  			
				});
	      });
	      
	      
	      
	      
	      

//사원리스트 보여줌     
function showList(){
	$.ajax({
		url : "/empList/getEmpList",
		method : "GET",
		dataType : "JSON",
		success : function(result){
			console.log(result);
			grid.resetData(result);
		}
	});
}
	});


</script>

</html>