<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<div class="main-content app-content">
	<div class="card card-custom">
		<div class="row">
			<div class="col-xl-12">
				<div class="card custom-card">
					<div class="card-header">
						<div class="card-title">테이블</div>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table id="vacation-table"
								class="table table-bordered text-nowrap w-100">
								<thead>
									<tr>
										<th>이름</th>
										<th>직무</th>
										<th>시작일</th>
										<th>종료일</th>
										<th>사용일</th>
										<th>잔여일</th>
										<th>작성일</th>
										<th>사유</th>
										<th style="width:90px;">작업</th>
									</tr>
								</thead>
								<tbody>
								<c:choose>
									<c:when test="${empty vacationReqList}">
										<tr>
											<td colspan="9">
												연가 신청 목록이 없습니다.
											</td>
										</tr>
									</c:when>
									<c:otherwise>
										<c:forEach items="${vacationReqList}" var="vacationReq">
											<tr>
												<td>${vacationReq.memName }</td>
												<td>${vacationReq.empJob }</td>
												 <td class="format-date" data-date="${vacationReq.vacationStartDate}"></td>
												 <td class="format-date" data-date="${vacationReq.vacationEndDate}"></td>
												<td>${vacationReq.vacationDate }일</td>
												<td>${vacationReq.empVacation} 일</td>
												 <td class="format-date" data-date="${vacationReq.vacationRequestDate}"></td>
												<td>${vacationReq.vacationReason }</td>
												<td style="font-size : 20px; padding:5px;">
													<a href="#" style="margin-left:25px;"><i class='bx bx-check vacationAgree'  
													data-reqno="${vacationReq.vacationRequestNo }" data-empno="${vacationReq.empNo }"></i></a> 
													<a href="#" style="margin-right:25px; float:right;"><i class='bx bx-x-circle vacationDisagree'></i></a>
												</td>
											</tr>
										</c:forEach>
									</c:otherwise>
								</c:choose>
								<c:if test=""></c:if>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="infoToast" class="toast colored-toast bg-info-transparent" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="toast-header bg-info text-fixed-white">
            <img class="bd-placeholder-img rounded me-2" src="../assets/images/brand-logos/toggle-dark.png" alt="...">
            <strong class="me-auto">원무과장</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"
                aria-label="Close"></button>
        </div>
        <div class="toast-body">
            연가 신청을 승인하셨습니다!
        </div>
    </div>
</div>
<script>
// connectWs();

$(function(){
	
	
	
	$('.vacationAgree').on("click",function(){
		console.log($(this));
		let that = $(this);
		let reqNo = $(this).data("reqno");
		let empNo = $(this).data("empno");
		console.log(reqNo);
		let data = {
				"vacationRequestNo" :reqNo,
				"empNo" : empNo
		};
		$.ajax({
			url : "/public/admin/vacationrequestagree.do",
			type : "post",
			data :JSON.stringify(data),
			contentType : "application/json;charset=utf-8",
			success : function(res){
				console.log(res);
				if(res === "SUCCESS"){
					that.closest('tr').remove();
                    $('#infoToast').toast('show');
//                     reloadDataTable();
//                     $('#vacation-table').DataTable().ajax.reload();
					ws.send("vacationResult#"+empNo+"#agree");
				}
			}
		});
	});
	$('.vacationDisagree').on("click",function(){
		console.log("거절");
	});
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
    $('.format-date').each(function() {
        var dateString = $(this).data('date');
        var formattedDate = formatDate(dateString);
        $(this).text(formattedDate);
    });
    
    function formatDate(dateString) {
        var year = dateString.substring(0, 4);
        var month = dateString.substring(5, 7);
        var day = dateString.substring(8, 10);
    
        return year + '년 ' + month + '월 ' + day + '일';
    }
})
</script>