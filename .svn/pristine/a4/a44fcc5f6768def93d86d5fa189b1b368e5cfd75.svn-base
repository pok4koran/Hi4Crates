<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%-- <%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %> --%>

        <!-- Start::app-content -->
        <div class="main-content app-content">
            <div class="container-fluid">

                <!-- Page Header -->
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <h1 class="page-title fw-semibold fs-18 mb-0">전체 통계</h1>
                    <div class="ms-md-1 ms-0">
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a href="javascript:void(0);">Ecommerce</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Products List</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                <!-- Page Header Close -->

                <!-- Start::row-1 -->
                <div class="row">   
                    <div class="col-xl-12">
                        <div class="card custom-card">
                            <div class="card-header">
                                <div class="card-title">
                                    	전체 통계 리스트
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive mb-4">
                                <!-- Start::row-1 -->
                <div class="row">
                    <div class="col-xl-6">
                        <div class="card custom-card">
                            <div class="card-header">
                                <div class="card-title">내원 환자수</div>
                            </div>
                            <div class="card-body">
                                <div id="pie-basic1"></div>
                            </div>
                        </div>
						<select id="monthSelect">
						    <option value="01">1월</option>
						    <option value="02">2월</option>
						    <option value="03">3월</option>
						    <option value="04">4월</option>
						    <option value="05">5월</option>
						    <option value="06">6월</option>
						    <option value="07">7월</option>
						    <option value="08">8월</option>
						    <option value="09">9월</option>
						    <option value="10">10월</option>
						    <option value="11">11월</option>
						    <option value="12">12월</option>
						</select>
						<select id="yearSelect">

						</select>
                    </div>
                <!--End::row-1 -->
                                </div>
                                <!-- 페이징 안넣고 스크롤만? -->
                            </div>
                        </div>
                    </div>
                </div>
                <!--End::row-1 -->
            </div>
        </div>
        <!-- End::app-content -->

        <!-- modal -->
        
    
    <!-- Scroll To Top -->
    <div class="scrollToTop">
        <span class="arrow"><i class="ri-arrow-up-s-fill fs-20"></i></span>
    </div>
    <div id="responsive-overlay"></div>
    <!-- Scroll To Top -->

    <!-- Popper JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/@popperjs/core/umd/popper.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Defaultmenu JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/defaultmenu.min.js"></script>

    <!-- Node Waves JS-->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/node-waves/waves.min.js"></script>

    <!-- Sticky JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/sticky.js"></script>

    <!-- Simplebar JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/simplebar/simplebar.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/js/simplebar.js"></script>

    <!-- Color Picker JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/@simonwep/pickr/pickr.es5.min.js"></script>


    
    <!-- Custom-Switcher JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/custom-switcher.min.js"></script>

    <!-- Apex Charts JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/apexcharts/apexcharts.min.js"></script>
    
	<!-- Internal Apex Pie Charts JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/apexcharts-pie.js"></script>
    
    <!-- Internal Product-Details JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/product-list.js"></script>

    <!-- Custom JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/custom.js"></script>
    
    <!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	
    

</body>
<script type="text/javascript">
/* basic pie chart */
$(function() {
    function render(year, month) {
    	console.log("연도"+year);
    	console.log("달"+month);
        let data = {
            statisticsYear: year,
            statisticsMonth: month
        };
        $.ajax({
            url: '/statistics/patientCount',
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function(response) {
            	var manCount = response.manCount;
                var womanCount = response.womanCount;
                
                console.log("남자 수 : " + manCount	);
                console.log("여자 수 : " + womanCount);
		        var options = {
		            series: [manCount, womanCount],
		            chart: {
		                height: 300,
		                type: "pie",
		            },
		            colors: ["#49b6f5", "#e6533c"],
		            labels: ["남자", "여자"],
		            legend: {
		                position: "bottom",
		            },
		            dataLabels: {
		                dropShadow: {
		                    enabled: false,
		                },
		            },
		        };
		        $("#pie-basic1").html("");
		        var chart = new ApexCharts(document.querySelector("#pie-basic1"), options);
		        chart.render();
            },
            error: function(xhr, status, error) {
                // 에러 처리 로직 추가
            }
        });
    }

    // 초기 연도와 월 설정
    var currentYear = new Date().getFullYear(); // 현재 연도를 가져옵니다.
    var currentMonth = new Date().getMonth() + 1; // 현재 월을 가져옵니다. getMonth()는 0부터 시작하므로 1을 더합니다.
    currentMonth = currentMonth < 10 ? '0' + currentMonth : currentMonth; // 1자리 숫자인 경우 앞에 0을 추가
	
    console.log(currentMonth);
    // 월 select 박스의 기본값 설정
    $('#monthSelect').val(currentMonth);

    // 년 select 박스의 옵션 추가 및 기본값 설정
    var yearSelect = document.getElementById("yearSelect");
    for (var year = currentYear; year >= 2020; year--) {
        var option = document.createElement("option");
        option.text = year + "년";
        option.value = year;
        yearSelect.add(option);
    }
    $('#yearSelect').val(currentYear);

    // 연도 및 월 변경 시 render 함수 호출
    $('#monthSelect, #yearSelect').change(function() {
        var selectedYear = $('#yearSelect').val();
        var selectedMonth = $('#monthSelect').val();
        console.log("선택된 년:", selectedYear);
        console.log("선택된 월:", selectedMonth);
        render(selectedYear, selectedMonth);
    });

    // 초기 로드 시 render 함수 호출
    render(currentYear, currentMonth);
});


</script>

</html>