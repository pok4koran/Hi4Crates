<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>


        <!-- Start::app-content -->
        <div class="main-content app-content">
            <div class="container-fluid">

                <!-- Page Header -->
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <h1 class="page-title fw-semibold fs-18 mb-0"></h1>
                    <div class="ms-md-1 ms-0">
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a href="javascript:void(0);">Ecommerce</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Order Details</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                <!-- Page Header Close -->

                <!-- Start::row-1 -->
                <div class="row">
                    <div class="col-xxl-2 col-xl-12">
						<div class="col-xxl-12 col-xl-6">
							<div class="card custom-card">
								<div class="card-header justify-content-between">
									<div class="card-title">환자목록</div>
									<div class="dropdown">
										<a href="javascript:void(0);" class="p-2 fs-12 text-muted"
											data-bs-toggle="dropdown" aria-expanded="false"> View All<i
											class="ri-arrow-down-s-line align-middle ms-1 d-inline-block"></i>
										</a>
										<ul class="dropdown-menu" role="menu">
											<li><a class="dropdown-item" href="javascript:void(0);">Today</a></li>
											<li><a class="dropdown-item" href="javascript:void(0);">This
													Week</a></li>
											<li><a class="dropdown-item" href="javascript:void(0);">Last
													Week</a></li>
										</ul>
									</div>
								</div>
								<div class="card-body" id="waitingList" style="height: 900px;" >
								</div>
							</div>
						</div>
					</div>
                    <div class="col-xl-4">
                        <div class="card custom-card" style="height: 50vh;">
                            <div class="card-header">
                                <div class="card-title">
                                    	오더 조회
                                </div>
                            </div>
                            <div class="card-body" id="orderArea" data-simplebar style="overflow-y: auto;">
                            	
                            </div>
                        </div>
                        <div class="row-xl-3">
                            <div class="card custom-card" style="height: 25vh;">
                                <div class="card-header">
                                    <div class="card-title">
                                        	방사선실 현황
                                    </div>
                                </div>
                                <div class="card-body" style="overflow-y: auto;" id="radiationRoomArea">
                                	<%-- <c:choose>
                                		<c:when test="${empty radiationRoomList }">
                                			<div>
                                            	<p class="fw-semibold mb-3 d-flex align-items-center"><a href="javascript:void(0);">방사선실 정보가 존재하지 않습니다.</a></p>
                                            	<br/>
                                            	<br/>
                                        	</div>
                                		</c:when>
                                		<c:otherwise>
                                			<c:forEach items="${radiationRoomList }" var="radiationRoom">
                                				<div>
                                            		<p class="fw-semibold mb-3 d-flex align-items-center"><a href="/radiation/radiationRoom?roomNo=${radiationRoom.rocNo }">${radiationRoom.rocName }</a></p>
                                            		<br/>
                                            		<br/>
                                        		</div>
                                			</c:forEach>
                                		</c:otherwise>
                                	</c:choose> --%>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="row">
                            <div class="col-xl-12">
                                <div class="card custom-card">
                                    <div class="card-header d-flex justify-content-between">
                                        <div class="card-title">
                                           	 촬영 결과 기록
                                        </div>
                                    </div>
                                    <div class="card-body">
                                    	<!-- dropzone 고치기 -->
                                    	<div class="mb-3">
                                    		<!-- 일단 넣어놓기만함 -->
                                    		수정 할 예정<br/>
                                    		<input type="text" /><br/>
                                    		<input type="text" /><br/>
                                    		<input type="text" /><br/>
                                    		<input type="text" /><br/>
                                    		<input type="text" /><br/>
                                    		<input type="text" /><br/>
										    <input class="form-control" type="file" id="formFile" multiple>
										</div>
                                        <span>코멘트</span>
                                        <input type="text" class="form-control">
                                        <input type="button" class="form-control btn btn-info" name="" id="" value="등록">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--End::row-1 -->

            </div>
        </div>
        <!-- End::app-content -->

        <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModal" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-body">
                  <div class="input-group">
                    <a href="javascript:void(0);" class="input-group-text" id="Search-Grid"><i class="fe fe-search header-link-icon fs-18"></i></a>
                    <input type="search" class="form-control border-0 px-2" placeholder="Search" aria-label="Username">
                    <a href="javascript:void(0);" class="input-group-text" id="voice-search"><i class="fe fe-mic header-link-icon"></i></a>
                    <a href="javascript:void(0);" class="btn btn-light btn-icon" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fe fe-more-vertical"></i>
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="javascript:void(0);">Action</a></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">Another action</a></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">Something else here</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">Separated link</a></li>
                    </ul>
                  </div>
                  <div class="mt-4">
                    <p class="font-weight-semibold text-muted mb-2">Are You Looking For...</p>
                    <span class="search-tags alert"><i class="fe fe-user me-2"></i>People<a href="javascript:void(0)" class="tag-addon" data-bs-dismiss="alert"><i class="fe fe-x"></i></a></span>
                    <span class="search-tags alert"><i class="fe fe-file-text me-2"></i>Pages<a href="javascript:void(0)" class="tag-addon" data-bs-dismiss="alert"><i class="fe fe-x"></i></a></span>
                    <span class="search-tags alert"><i class="fe fe-align-left me-2"></i>Articles<a href="javascript:void(0)" class="tag-addon" data-bs-dismiss="alert"><i class="fe fe-x"></i></a></span>
                    <span class="search-tags alert"><i class="fe fe-server me-2"></i>Tags<a href="javascript:void(0)" class="tag-addon" data-bs-dismiss="alert"><i class="fe fe-x"></i></a></span>
                  </div>
                  <div class="my-4">
                    <p class="font-weight-semibold text-muted mb-2">Recent Search :</p>
                    <div class="p-2 border br-5 d-flex align-items-center text-muted mb-2 alert">
                      <a href="notifications.html"><span>Notifications</span></a>
                      <a class="ms-auto lh-1" href="javascript:void(0);" data-bs-dismiss="alert" aria-label="Close"><i class="fe fe-x text-muted"></i></a>
                    </div>
                    <div class="p-2 border br-5 d-flex align-items-center text-muted mb-2 alert">
                      <a href="alerts.html"><span>Alerts</span></a>
                      <a class="ms-auto lh-1" href="javascript:void(0);" data-bs-dismiss="alert" aria-label="Close"><i class="fe fe-x text-muted"></i></a>
                    </div>
                    <div class="p-2 border br-5 d-flex align-items-center text-muted mb-0 alert">
                      <a href="mail.html"><span>Mail</span></a>
                      <a class="ms-auto lh-1" href="javascript:void(0);" data-bs-dismiss="alert" aria-label="Close"><i class="fe fe-x text-muted"></i></a>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <div class="btn-group ms-auto">
                    <button type="button" class="btn btn-sm btn-primary-light">Search</button>
                    <button type="button" class="btn btn-sm btn-primary">Clear Recents</button>
                  </div>
                </div>
              </div>
            </div>
        </div>
       <div class="modal fade" id="formmodal" tabindex="-1"
                                        aria-labelledby="exampleModalLabel" aria-hidden="true">
	       <div class="modal-dialog">
	           <div class="modal-content">
	               <div class="modal-header">
	                   <h6 class="modal-title" id="exampleModalLabel"></h6>
	                   <button type="button" class="btn-close" data-bs-dismiss="modal"
	                       aria-label="Close"></button>
	               </div>
	               <div class="modal-body">
	                   <form>
	                       <div class="mb-3">
	                           <label for="recipient-name"
	                               class="col-form-label">Recipient:</label>
	                           <input type="text" class="form-control" id="recipient-name">
	                       </div>
	                       <div class="mb-3">
	                           <label for="message-text"
	                               class="col-form-label">Message:</label>
	                           <textarea class="form-control" id="message-text"></textarea>
	                       </div>
	                   </form>
	               </div>
	               <div class="modal-footer">
	                   <button type="button" class="btn btn-secondary"
	                       data-bs-dismiss="modal">Close</button>
	                   <button type="button" class="btn btn-primary">Send
	                       message</button>
	               </div>
	           </div>
	       </div>
	   </div>


    
    <!-- Scroll To Top -->
    <div class="scrollToTop">
        <span class="arrow"><i class="ri-arrow-up-s-fill fs-20"></i></span>
    </div>
    <div id="responsive-overlay"></div>
    <!-- Scroll To Top -->

    <!-- Popper JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/@popperjs/core/umd/popper.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Defaultmenu JS -->
    <%-- <script src="${pageContext.request.contextPath }/resources/assets/js/defaultmenu.min.js"></script> --%>

    <!-- Node Waves JS-->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/node-waves/waves.min.js"></script>

    <!-- Sticky JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/sticky.js"></script>

    <!-- Simplebar JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/simplebar/simplebar.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/js/simplebar.js"></script>

    <!-- Color Picker JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/@simonwep/pickr/pickr.es5.min.js"></script>
    
    <!-- Custom JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/custom.js"></script>

    <!-- Custom-Switcher JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/custom-switcher.min.js"></script>

    <!-- Prism JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/prismjs/prism.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/js/prism-custom.js"></script>
    
    <!-- Modal JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/radiation_modal.js"></script>

    
    <!-- Filepond JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond/filepond.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-image-preview/filepond-plugin-image-preview.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-image-exif-orientation/filepond-plugin-image-exif-orientation.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-file-validate-size/filepond-plugin-file-validate-size.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-file-encode/filepond-plugin-file-encode.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-image-edit/filepond-plugin-image-edit.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-file-validate-type/filepond-plugin-file-validate-type.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-file-validate-type/filepond-plugin-file-validate-type.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-image-crop/filepond-plugin-image-crop.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-image-resize/filepond-plugin-image-resize.min.js"></script>
    <script src="${pageContext.request.contextPath }/resources/assets/libs/filepond-plugin-image-transform/filepond-plugin-image-transform.min.js"></script>
    
    <!-- Dropzone JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/libs/dropzone/dropzone-min.js"></script>
    
    <!-- Fileupload JS -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/fileupload.js"></script>
    
    <!-- Custom JS -->
    <%-- <script src="${pageContext.request.contextPath }/resources/assets/js/custom.js"></script> --%>

</body>
<script>
	let previewLoc = $("#previewLoc");
	let previewDoctor = $("#previewDoctor");
	let previewMemName = $("#previewMemName");
	let previewMemGender = $("#previewMemGender");
	let previewMemAge = $("#previewMemAge");
	let previewMemRegno1 = $("#previewMemRegno1");
	let previewMemTel = $("#previewMemTel");
	
    function getWaitingList(){
        $.ajax({
            url: '/radiation/radiationWaitingList', // 서버의 엔드포인트 URL을 여기에 입력
            type: 'POST',
            dataType: 'json', // 서버에서 응답으로 JSON을 사용하는 경우
            success: function(data) {
            	
            	//처음 프리뷰 화면에 첫번째 환자 정보 일단 띄우기
            	previewLoc.text(data[0].codeName);	//진료실이름
            	previewMemName.text(data[0].memName); //환자이름
            	previewMemGender.text(data[0].memGender); //환자성별
            	previewMemAge.text(data[0].memAge); //환자나이
            	previewMemRegno1.text(data[0].memRegno1); //환자나이
            	previewMemTel.text(data[0].memTel); //환자나이
            	
            	
                // 서버에서 받은 데이터를 처리하여 HTML 업데이트
                var html = '';
                $.each(data, function(index, item) {
                    html += '<div class="card custom-card hrm-main-card primary">';
                    html += '    <div class="card-header" style="padding: 4%;">';
                    html += '        <h8 class="fw-semibold mt-1" style="padding: -10%;">' + item.codeName + '</h8>';
                    html += '    </div>';
                    html += '    <div class="card-body">';
                    html += '        <div class="d-flex align-items-top">';
                    html += '            <div class="me-3">';
                    html += '                <span class="avatar bg-primary"> <i class="ri-team-line fs-18"></i></span>';
                    html += '            </div>';
                    html += '            <div class="row">';
                    html += '                <h6 class="fw-semibold mt-1">';
                    html += '                    <a href="javascript:void(0)" id="watingMemName" data-memNo="'+item.memNo+'">' + item.memName + '</a>';
                    html += '                    <span class="badge bg-secondary-transparent" style="float: right;">' + item.ccodeName + '</span>';
                    html += '                </h6>';
                    html += '                <div>';
                    html += '                    <span class="fs-12 mb-0">' + item.memGender + ', ' + item.memAge + '세</span>';
                    html += '                </div>';
                    html += '            </div>';
                    html += '        </div>';
                    html += '    </div>';
                    html += '</div>';
                });
                // HTML 업데이트
                $('#waitingList').html(html);
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText); // 에러 처리
            }
        });
     }
     // 페이지 로드 후 처음 한 번 요청을 실행
     getWaitingList();

     // 3초마다 비동기 요청 반복 실행
     setInterval(getWaitingList, 10000);
    
    
     
     $('body').on('click','#watingMemName',function(event){
    	 
     	event.preventDefault();
     	
     	let memNo = $(this).attr('data-memNo');
     	
     	console.log(memNo);
     	
     	let data = {
     			memNo : memNo
     	}
     	
     	$.ajax({
     		url : "/radiation/getPatntOrder",
     		type : "post",
     		contentType : "application/json",
     		data : JSON.stringify(data),
     		success : function (res) {
				console.log(res);
				
				// json데이터로 order 화면에 띄워주기(수정해야함)
				let orderArea = $('#orderArea');
				let html = "";
				html += res.memName + "<br/>";
				html += res.memGender + "<br/>";
				html += res.orderName + "<br/>";
				html += res.bodyCode + "<br/>";
				html += res.chartDate + "<br/>";
				html += res.chartRecord + "<br/>";
				html += res.docName + "<br/>";
				orderArea.html(html);
			}
     	});
     });
     
     // 방사선실 현황 비동기로 다시
     function getRadiationRoomList() {
    	 $.ajax({
    	    	url : "/radiation/radiationRoomList",
    	    	type : "get",
    	    	success : function (res) {
    				let radiationRoomArea = $('#radiationRoomArea');
    				let html = "";
    				$.each(res, function(index, item) {
    					html += '<div class="d-flex align-items-center">';
    					html += '	<div class="orders-delivery-address">';
    					html += '		<a href="/radiation/radiationRoom?roomNo='+item.rocNo+'">';
    					html += '			<p class="mb-1 fw-semibold">'+item.rocName+'</p>';
    					html += '		</a>';
    					html += '		<p class="text-muted mb-0">';
    					html += '			 여기 뭐 들어갈지 고민중임';
    					html += '		</p>';
    					html += '	</div>';
    					html += '	<div class="ms-auto">';
    					if (item.rocStatus.trim() == "ROC002") {
	    					html += '		<span class="badge bg-danger">'+item.rocStatusname+'</span>';
						} else {
	    					html += '		<span class="badge bg-info">'+item.rocStatusname+'</span>';
						}
    					html += '	</div>';
    					html += '</div>';
    					html += '<br/>';
    				});
    				radiationRoomArea.html(html);
    			}
    	 });
	 }
     
     // 페이지 로드 시 한번 실행
     getRadiationRoomList();
     
     // 일정 시간마다 반복실행
     setInterval(getRadiationRoomList, 10000);
    
</script>

</html>