<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%>
<!DOCTYPE html>
<html lang="en" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light" data-menu-styles="dark" data-toggled="close">

<head>
<meta id="_csrf" name="_csrf" content="${_csrf.token }">
<meta id="_csrf_header" name="_csrf_header" content="${_csrf.headerName }">

<!-- Meta Data -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>YNEX - Bootstrap 5 Premium Admin &amp; Dashboard Template
</title>
<meta name="Description"
	content="Bootstrap Responsive Admin Web Dashboard HTML5 Template">
<meta name="Author" content="Spruko Technologies Private Limited">
<meta name="keywords"
	content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit.">


<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<style type="text/css">
.ui-autocomplete {
  max-height: 200px;
  overflow-y: auto;
  /* prevent horizontal scrollbar */
  overflow-x: hidden;
  height: auto;
}

.ui-menu-item div.ui-state-hover,
.ui-menu-item div.ui-state-active {
  color: #ffffff;
  text-decoration: none;
  background-color: #f6B664;
  border-radius: 0px;
  -webkit-border-radius: 0px;
  -moz-border-radius: 0px;
  background-image: none;
  border:none;
}

</style>

</head>

<body>
<div class="main-content app-content">
            <div class="container-fluid">

                <!-- Page Header -->
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <h1 class="page-title fw-semibold fs-18 mb-0">Profile</h1>
                    <div class="ms-md-1 ms-0">
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a href="javascript:void(0);">Pages</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Profile</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                <!-- Page Header Close -->

				<!-- Start::row-1 -->
				<div class="row">
					<div class="col-xxl-2 col-xl-12">
						<div class="col-xxl-12 col-xl-6">
							<div class="card custom-card">
								<div class="card-header justify-content-between">
									<div class="card-title">환자목록</div>
									<div class="dropdown">
										<a href="javascript:void(0);" class="p-2 fs-12 text-muted"
											data-bs-toggle="dropdown" aria-expanded="false"> View All<i
											class="ri-arrow-down-s-line align-middle ms-1 d-inline-block"></i>
										</a>
										<ul class="dropdown-menu" role="menu">
											<li><a class="dropdown-item" href="javascript:void(0);">Today</a></li>
											<li><a class="dropdown-item" href="javascript:void(0);">This
													Week</a></li>
											<li><a class="dropdown-item" href="javascript:void(0);">Last
													Week</a></li>
										</ul>
									</div>
								</div>
								<div class="card-body" id="waitingList" style="height: 900px;" >

									</div>
							</div>
						</div>
					</div>
					<!-- 차트 div  -->
					<div class="col-xxl-10 col-xl-12">
						<!--처음화면 영역-->
						<div id="previewPatient">
                            <div class="col-xl-12 mx-auto d-flex align-items-center justify-content-center" style="height: 500px;">
                                <div class="position-relative">
                                    <div style="text-align: center;">
                                        <img src="${pageContext.request.contextPath }/resources/assets/img/doctorMainChart.png" alt="의료진이미지" class="mx-auto" style="max-width: 600px;">
                                    </div>
                                    <div class="card custom-card overflow-hidden" style="margin-bottom: -300px; width: 600px; margin-top: -30px;">
                                        <div class="card-body">
                                            <p class="mb-1 text-muted"  id="previewDoctor"><span class="badge bg-info-transparent" id="previewLoc">진료실이다</span>
                                                <i class="las la-stethoscope mb-3"></i> 김의사
                                            </p>
                                            <h5 class="fw-semibold d-inline-block mb-2" id="previewMemName">김환자 </h5>
                                            <p class="fw-semibold text-muted d-inline-block mb-3" id="previewMemGender">남</p>
                                            <p class="fw-semibold text-muted d-inline-block mb-3" id="previewMemAge">23세</p>
                                            <p class="text-muted mb-3">생년월일  : <span class="text-muted" id="previewMemRegno1">990101</span></p>
                                            <p class="text-muted mb-3">휴대폰번호  : <span class="text-muted mb-3" id="previewMemTel"></span></p>
                                            <button type="button" class="btn btn-info btn-wave" id="startChart" style="float: right;">진료시작</button>
                                            <button type="button" class="btn btn-outline-info btn-wave" style="float: right; margin-right: 10px;">차트열기</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                           </div>
                        <!-- 처음화면 영역 끝 -->
					
					<!-- 차트 상세 -->
					<div id="chartView" style="display: none;">
						<div class="row" style="background-color: white; border-radius: 1%;">
							<div class="col-xl-3" style="border-right: solid 1px rgb(229, 228, 228);">
								<div class="row">
									<div class="col-xl-12">
										<div class="card custom-card">
											<div class="card-body">
												<div class="row">
													<div
														class="col-xxl-3 col-xl-2 col-lg-3 col-md-3 col-sm-4 col-4 d-flex align-items-center justify-content-center ecommerce-icon success px-0">
														<span class="rounded p-3 bg-success-transparent"> <svg
																xmlns="http://www.w3.org/2000/svg"
																class="svg-white success" height="24px"
																viewBox="0 0 24 24" width="24px" fill="#000000">
																<path d="M0 0h24v24H0V0z" fill="none" />
																<path
																	d="M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" /></svg>
														</span>
													</div>
													<div
														class="col-xxl-9 col-xl-10 col-lg-9 col-md-9 col-sm-8 col-8 px-0" >
														<div class="mb-2">
															<span
																class="badge bg-success-transparent text-success px-1 py-2 fs-10"></span>
														</div>
														<div class="text-muted mb-1 fs-12">
															<span class="text-dark fw-semibold fs-20 lh-1 vertical-bottom" id="chartPatientName">
<!-- 																김환자 -->
																<button type="button" class="btn btn-outline-success rounded-pill btn-wave btn-sm" style="float: right;">진료시작</button>
															</span>
														</div>
														
															<p class="fs-12 mb-0">
																<span id="chartPatientGender"></span>
																<span id="chartPatientAge"></span>세
																<span id="chartPatientRegno1"></span>
															</p>
															<!-- 남, 23세(1999-09-09)  --> 
														
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-12">
									<div class="card custom-card">
										<div class="card-header  justify-content-between">
											<div class="card-title">내원이력</div>
											<div class="dropdown">
												<a aria-label="anchor" href="javascript:void(0);" class="btn btn-icon btn-sm btn-light"
													data-bs-toggle="dropdown" aria-expanded="false"> 
													<i class="fe fe-more-vertical"></i>
												</a>
												<ul class="dropdown-menu">
													<li><a class="dropdown-item" href="javascript:void(0);">Week</a></li>
													<li><a class="dropdown-item" href="javascript:void(0);">Month</a></li>
													<li><a class="dropdown-item" href="javascript:void(0);">Year</a></li>
												</ul>
											</div>
										</div>
										<div class="card-body" style="overflow-y: scroll; height: 500px;"  >
											<div class="accordion accordion-border-dark accordions-items-seperate" id="accordionprimaryborderExample">
<!-- 												내원이력 동적생성 영역 -->
											
											</div>
										</div>
									</div>
								</div>
								<div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
									<div class="card custom-card"
										style="border: solid 1px rgb(229, 228, 228);">
										<div class="card-header justify-content-between">
											<div class="card-title">ㅇㅇㅇㅇ</div>
											<div class="dropdown">
												<a href="javascript:void(0);" class="p-2 fs-12 text-muted"
													data-bs-toggle="dropdown" aria-expanded="false"> View
													All<i
													class="ri-arrow-down-s-line align-middle ms-1 d-inline-block"></i>
												</a>
												<ul class="dropdown-menu" role="menu">
													<li><a class="dropdown-item"
														href="javascript:void(0);">Today</a></li>
													<li><a class="dropdown-item"
														href="javascript:void(0);">This Week</a></li>
													<li><a class="dropdown-item"
														href="javascript:void(0);">Last Week</a></li>
												</ul>
											</div>
										</div>
										<div class="card-body">
											<div>
												1. x-ray <br> 2. mri
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-xl-6">
								<div class="row">
									<div class="col-xl-12">
										<div class="card custom-card">
											<div class="card-header justify-content-between">
												<div class="card-title" id="currentTime">2024-03-24 14:00</div>
												<div class="dropdown">
													<a href="javascript:void(0);" class="p-2 fs-12 text-muted"
														data-bs-toggle="dropdown" aria-expanded="false"> View
														All<i
														class="ri-arrow-down-s-line align-middle ms-1 d-inline-block"></i>
													</a>
													<ul class="dropdown-menu" role="menu">
														<li><a class="dropdown-item"
															href="javascript:void(0);">Today</a></li>
														<li><a class="dropdown-item"
															href="javascript:void(0);">This Week</a></li>
														<li><a class="dropdown-item"
															href="javascript:void(0);">Last Week</a></li>
													</ul>
												</div>
											</div>

										</div>
									</div>
									<div class="col-xl-12">
										<div class="card custom-card"
											style="border: solid 1px rgb(229, 228, 228);">
											<div class="card-header justify-content-between">

												<div class="card-title">진료기록</div>
												<div class="dropdown">
													<a href="javascript:void(0);" class="p-2 fs-12 text-muted"
														data-bs-toggle="dropdown" aria-expanded="false"> View
														All<i
														class="ri-arrow-down-s-line align-middle ms-1 d-inline-block"></i>
													</a>
													<ul class="dropdown-menu" role="menu">
														<li><a class="dropdown-item"
															href="javascript:void(0);">Today</a></li>
														<li><a class="dropdown-item"
															href="javascript:void(0);">This Week</a></li>
														<li><a class="dropdown-item"
															href="javascript:void(0);">Last Week</a></li>
													</ul>
												</div>
											</div>
											<div class="card-body">
												<div class="content-wrapper">
													<div id="crm-revenue-analytics">
														<textarea class="form-control" id="chartRecord"  rows="10"></textarea>
														<div class="col-xl-12">
															<div class="card custom-card">
																<div class="card-header">
																	<div class="card-title">사진 첨부</div>
																</div>
															<form method="post" action="/doctor/insertImg" id="imgForm" enctype="multipart/form-data">
																<div class="form-group">
																	<div class="custom-file">
																		<input type="file" class="custom-file-input" id="chartFile" name="chartFile" multiple="multiple"> 
																			<label class="custom-file-label" for="customFile"></label>
																	</div>
																	<div class="uploadedList"></div>
																</div>
																<sec:csrfInput />
															</form>
<!-- 																<div -->
<!-- 																     class="dropzone" -->
<!-- 																     id="my-dropzone"> -->
<!-- 																 </div> -->
															</div>
														</div>

													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="col-xl-12">
										 <div class="card custom-card" style="border: solid 1px rgb(229, 228, 228);">
                                            <div class="card-header justify-content-between">
                                                <div class="card-title">
                                                   		진단 및 처방
                                                </div>
                                                <div class="">
                                                <button class="btn btn-secondary-light btn-sm btn-wave waves-effect waves-light" data-bs-toggle="modal"
                                                data-bs-target="#insert-orderGroup" id="orderSetInsertBtn">
                                                    <i class="ri-add-line me-1 align-middle"></i>오더세트 등록
                                                </button>
                                            </div>
                                        </div>
                                        
                                         <!--오더세트 등록 모달 시작-->
                                                <div class="modal fade" id="insert-orderGroup" aria-labelledby="insert-orderGroupLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h6 class="modal-title" id="insert-orderGroupLabel">오더세트 등록</h6>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body px-4">
                                                                <div class="row gy-3">
                                                                    <div class="col-xl-12">
                                                                        <label for="orderName" class="form-label">오더세트명</label>
                                                                        <input type="text" class="form-control" id="orderName" placeholder="Enter Name">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal" id="closeModal">Cancel</button>
                                                                <button type="button" class="btn btn-sm btn-primary" id="createOrderName" >Create</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                                <!--오더세트 등록 모달 끝-->
                                        
											<div class="card-body" style="margin-top: -2%;">
												<ul class="nav nav-pills nav-style-3" role="tablist">
	                                                <li class="nav-item">
	                                                    <a class="nav-link active" data-bs-toggle="tab" role="tab" aria-current="page"
	                                                    href="#searchDiseases" aria-selected="true">상병</a>
	                                                </li>
	                                                <li class="nav-item">
	                                                    <a class="nav-link" data-bs-toggle="tab" role="tab" aria-current="page"
	                                                    href="#searchMedicine" aria-selected="true">약물</a>
	                                                </li>
	                                            </ul><br/>
												<div class="input-group mb-3" style="margin-top: -2%;">
													<input type="text" class="form-control" placeholder="검색어를 입력하세요" id="searchBox" aria-label="Recipient's username" aria-describedby="button-addon2">
												</div>
												<div class="content-wrapper" style="height: 100px;">
													<div id="crm-revenue-analytics">
														<div class="kanban-tasks-type new">
                                                        <div class="kanban-tasks" id="new-tasks">
                                                            <!-- <span class="badge rounded-pill bg-danger-transparent" style="pointer-events: none;">주상병</span> -->
                                                            <div id="new-tasks-draggable" data-view-btn="new-tasks">
                                                                <span class="badge rounded-pill bg-danger-transparent m-2" id="primaryDisease" style="pointer-events: none;">주상병</span>
                                                            </div>
                                                        </div>
                                                        <div></div>
                                                    </div>
                                                    <div class="kanban-tasks-type todo">
                                                        <div class="kanban-tasks" id="todo-tasks">
                                                            <div id="todo-tasks-draggable" data-view-btn="todo-tasks">
                                                                <span class="badge rounded-pill bg-danger-transparent m-2" style="pointer-events: none;" id="secondDisease">부상병</span><br/>
                                                            </div>
                                                        </div>
                                                    </div>
														<div>
															<span class="badge rounded-pill bg-info-transparent m-2" id="medicinePrescription">처방</span><br/>
														</div>
														<div>
															<span class="badge rounded-pill bg-success-transparent m-2">물리치료</span>
															<div>
																
															
																치료방법: <span class="mb-1 text-truncate timeline-widget-content text-wrap" id="selectedPt"></span><br/>
																치료부위:<span class="mb-1 text-truncate timeline-widget-content text-wrap" id="selectedbodyPart"></span>
															</div>
														</div>
														<div>
															<br />


														</div>
													</div>

													<div class="btn-list">
<!-- 														<button type="button" -->
<!-- 															class="btn btn-secondary-light btn-wave" -->
<!-- 															data-bs-toggle="modal" -->
<!-- 															data-bs-target="#exampleModalScrollable3">진단서</button> -->
														<button type="button" class="btn btn-warning-light btn-wave">진단서/소견서</button>
														<button type="button" class="btn btn-success-light btn-wave" id="requestPT" data-bs-toggle="modal" data-bs-target="#requestPTModal">물리치료요청</button>
														<button type="button" class="btn btn-danger-light btn-wave" id="collaborationBtn" data-bs-toggle="modal" data-bs-target="#collaboration">협진요청</button>
														<button type="button"class="btn btn-primary-light btn-wave"id="insertChartBtn" style="float: right;">진료완료</button>
													</div>
													<div>
														<br>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
								<!--물리치료요청 모달 시작-->
								<div class="modal fade" id="requestPTModal" tabindex="-1"
									aria-labelledby="exampleModalScrollable2"
									data-bs-keyboard="false" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered">
										<div class="modal-content">
											<div class="modal-header">
												<h6 class="modal-title" id="staticBackdropLabel2">물리치료 요청</h6>
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											<div class="modal-body">
												<div class="row">
													<div class="card custom-card">
														<div class="card-body">
															<div class="card-body" style="padding: 0;">
																<div class="form-check form-check-md d-flex align-items-center">
																	<input class="form-check-input" type="checkbox" name="ptSelect" value="OD003" id="OD003"> 
																	<label class="form-check-label" for="OD003"
																		style="margin-right: 10%;"> 온열치료 </label> 
																	<input class="form-check-input" type="checkbox" name="ptSelect" value="OD008" id="OD008">
																	<label class="form-check-label" for="OD008" style="margin-right: 10%;"> 초음파치료</label> 
																	<input class="form-check-input" type="checkbox" name="ptSelect" value="OD009" id="OD009">
																	<label class="form-check-label" for="OD009"> 충격파치료 </label>
																</div>
																<br />
																 <label class="" for="bodyPart">촬영부위</label>
																 <select class="js-example-basic-multiple" name="bodyPartList2" id="bodyPartList2" multiple="multiple">
																	<option value="B001">어깨/Shoulder</option>
																	<option value="B002">팔/Elbow</option>
																	<option value="B003">손목/Wrist</option>
																	<option value="B004">엄지/Thumb</option>
																	<option value="B005">손가락/Finger</option>
																	<option value="B006">고관절/Hip</option>
																	<option value="B007">무릎/Knee</option>
																	<option value="B008">발목/Ankle</option>
																	<option value="B009">경추/Cervical</option>
																	<option value="B010">흉추/Thoracic</option>
																	<option value="B011">요추/Lumbar</option>
																	<option value="B012">엉치/Sacrum</option>
																	<option value="B013">꼬리뼈/Coccyx</option>
																</select>
															</div>
															<button type="button" class="btn btn-outline-primary btn-wave mt-2 mb-2" data-bs-dismiss="modal" aria-label="Close" id="ptBtn" style="float: right;">입력</button>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!--물리치료 모달 끝-->

							<!-- 진단서 모달 -->
							<div class="modal fade" id="exampleModalScrollable3"
								tabindex="-1" aria-labelledby="exampleModalScrollable3"
								data-bs-keyboard="false" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
									<div class="modal-content">
										<div class="modal-header">
											<h6 class="modal-title" id="staticBackdropLabel3">진단서</h6>
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<div class="modal-body">
											<p>
											<div class="row">
												<div class="col-xxl-12 col-xl-12">
													<div class="row">
														<div class="col-xl-12"></div>
														<div class="col-xl-12">
															<div class="card custom-card">
																<div class="card-body">
																	<div class="content-wrapper">
																		<div id="crm-revenue-analytics">
																			<div class="row">
																				<div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">환자
																						성명</label> <input type="text" class="form-control"
																						id="pName">
																					<div class="invalid-feedback">이름은 6글자 이상입니다.</div>
																				</div>
																				<div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">주민등록번호</label>
																					<input type="text" class="form-control"
																						id="input-label">
																				</div>
																			</div>
																			<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																				<label for="input-label" class="form-label">주소</label>
																				<input type="text" class="form-control"
																					id="input-label">
																			</div>
																			<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																				<label for="input-label" class="form-label">전화번호</label>
																				<input type="" class="form-control" id="input-label">
																			</div>
																			<div class="row">
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="text-area" class="form-label">병명</label>
																					<textarea class="form-control" id="text-area"
																						rows="1"></textarea>
																				</div>
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">한국질병분류번호</label>
																					<input type="" class="form-control"
																						id="input-label">
																				</div>
																			</div>
																			<div class="row">
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-date" class="form-label">발병일</label>
																					<input type="date" class="form-control"
																						id="input-date">
																				</div>
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-date" class="form-label">진단일</label>
																					<input type="date" class="form-control"
																						id="input-date">
																				</div>
																			</div>
																			<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																				<label for="text-area" class="form-label">향후치료소견</label>
																				<textarea class="form-control" id="text-area"
																					rows="4" style="width: 400px;"></textarea>
																			</div>
																			<div class="row">
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">비고</label>
																					<input type="" class="form-control"
																						id="input-label">
																				</div>
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">용도</label>
																					<input type="" class="form-control"
																						id="input-label">
																				</div>
																			</div>

																			<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																				<label for="input-label" class="form-label">발행일</label>
																				<input type="" class="form-control" id="input-label">
																			</div>
																			<div class="row">
																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">면허번호</label>
																					<input type="" class="form-control"
																						id="input-label">
																				</div>

																				<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
																					<label for="input-label" class="form-label">의사성명</label>
																					<input type="" class="form-control"
																						id="input-label">
																				</div>

																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
											</p>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary"
												data-bs-dismiss="modal">Close</button>
											<button type="button" class="btn btn-primary">발행</button>
										</div>
									</div>
								</div>
							</div>
							<!--진단서 모달 끝-->
							<!-- 협진요청 모달 시작 -->
							<div class="modal fade" id="collaboration" tabindex="-1" aria-labelledby="collaboration" data-bs-keyboard="false"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="col-xl-12"></div>
                            <div class="card custom-card">
                                <div class="modal-header">
                                    <div class="card-title">협진요청</div>
                                </div>
                                <div class="modal-body px-4">
                                    <div class="row gy-3">
                                        <div class="col-xl-12">
                                            <p class="fw-semibold mb-2"> 환자명 :<span id="collabo_patientName">김환자 </span><span id="collabo_patientBirth">960101 </span><span id="collabo_gender">남 </span></p>
                                            <p class="fw-semibold mb-2">
                                                	주상병 : <span id="collabo_disease">손목터널</span>
                                            </p>
                                            <p class="fw-semibold mb-2">의사선택</p>
                                            <select class="form-control" data-trigger name="choices-single-default" id="selectDoctor">
                                                <option value="">의사선택</option>
                                                <option value="1">김태원</option>
                                                <option value="2">선민수</option>
                                                <option value="3">최현흠</option>
                                            </select>
                                            <textarea class="form-control" id="collabo_comment" rows="5"></textarea>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-primary btn-wave mt-2 mb-2" data-bs-dismiss="modal"
                                            id="closeColaboModal">취소</button>
                                        <button type="button" class="btn btn-outline-primary btn-wave mt-2 mb-2"
                                            id="collaboRequestBtn">요청</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
							<!-- 협진요청 모달 끝 -->

							<div class="col-xl-3"
								style="border-left: solid 1px rgb(229, 228, 228);">
								<div class="row">
									<div class="col-xxl-12 col-xl-12">
										<div class="row">
											<div class="col-xl-12 col-xl-6">
												<div
													class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
													<div class="card custom-card">
														<div class="card-header justify-content-between">
															<div class="card-title">검사결과</div>
															<div class="dropdown">
																<a href="javascript:void(0);"
																	class="p-2 fs-12 text-muted" data-bs-toggle="dropdown"
																	aria-expanded="false"> View All<i
																	class="ri-arrow-down-s-line align-middle ms-1 d-inline-block"></i>
																</a>
																<ul class="dropdown-menu" role="menu">
																	<li><a class="dropdown-item"
																		href="javascript:void(0);">Today</a></li>
																	<li><a class="dropdown-item"
																		href="javascript:void(0);">This Week</a></li>
																	<li><a class="dropdown-item"
																		href="javascript:void(0);">Last Week</a></li>
																</ul>
															</div>
														</div>
														<div class="card-body">
															<ul class="list-unstyled">
																<!-- list-unstyled 클래스 추가 -->
																<div>────────2024.03.03.───────</div>
																<br />
																<li class="mail-type"><a href="javascript:void(0);">

																		<div>
																			<div class="d-flex align-items-center">
																				<span class="me-2 lh-1"> <i
																					class="ri-inbox-archive-line align-middle fs-14"></i>
																				</span> <span class="flex-fill text-nowrap">
																					Rf.foot,lateral,oblique view </span><br>
																			</div>
																</a></li>
																<br />
																<li class="mail-type"><a href="javascript:void(0);">

																		<div>
																			<div class="d-flex align-items-center">
																				<span class="me-2 lh-1"> <i
																					class="ri-inbox-archive-line align-middle fs-14"></i>
																				</span> <span class="flex-fill text-nowrap">
																					Rf.ancle,lateral,oblique view </span><br>
																			</div>
																</a></li>
															</ul>

															<div>
																<button type="button" class="btn btn-outline-info rounded-pill btn-wave" id="requestRadiationBtn" data-bs-toggle="modal" data-bs-target="#requestRadiationModal" style="float: right;">검사요청</button>
															</div>
														</div>
													</div>
												</div>
												
												
												
<!-- 검사요청 모달 시작 -->
<div class="modal fade" id="requestRadiationModal" tabindex="-1" aria-labelledby="exampleModalScrollable2" data-bs-keyboard="false" aria-hidden="true">
    <!-- Scrollable modal -->
    <div class="modal-dialog modal-dialog-centered" >
        <div class="modal-content" >
            <div class="modal-header" >
                <h6 class="modal-title" id="staticBackdropLabel2">방사선실 검사 요청</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="card custom-card" >
                    	<form action="/doctor/orderRadiation" method="post" id="orderRadiation">
	                    	<input type="hidden" name="patntNo" id="patntNo" value="">
	                    	<input type="hidden" name="receiptNo" id="receiptNo" value="">
                        	<div class="card-body">
                            <div class="card-body" style="padding: 0;">
                                <div class="form-check form-check-md d-flex align-items-center"> 
                                    <input class="form-check-input" type="radio" value="OD001" name="checkTechnique">
                                    <label class="form-check-label" for="xray" style="margin-right: 40px;">
                                        X-RAY
                                    </label>
                                    <input class="form-check-input" type="radio" value="OD002" name="checkTechnique">
                                    <label class="form-check-label" for="MRI">
                                        MRI
                                    </label>
                                </div>
                                <br />
                                <label class="" for="bodyPart">촬영부위</label>
                                <select class="js-example-basic-multiple" name="bodyPartList" id="bodyPartList" multiple="multiple">
                                    <option value="B001">어깨/Shoulder</option>
                                    <option value="B002">팔/Elbow</option>
                                    <option value="B003">손목/Wrist</option>
                                    <option value="B004">엄지/Thumb</option>
                                    <option value="B005">손가락/Finger</option>
                                    <option value="B006">고관절/Hip</option>
                                    <option value="B007">무릎/Knee</option>
                                    <option value="B008">발목/Ankle</option>
                                    <option value="B009">경추/Cervical</option>
                                    <option value="B010">흉추/Thoracic</option>
                                    <option value="B011">요추/Lumbar</option>
                                    <option value="B012">엉치/Sacrum</option>
                                    <option value="B013">꼬리뼈/Coccyx</option>
                                </select>
                            </div>
                
	                            <button type="button" class="btn btn-outline-primary btn-wave mt-2 mb-2" id="radiationSendBtn" style="float: right;">전송
	                            </button>		
                        	</div>
                        	<sec:csrfInput />
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 검사요청 모달 끝 -->
												<div class="card custom-card" style="border: solid 1px rgb(229, 228, 228); margin-bottom: 0%">
													<div class="card-header  justify-content-between">
                                            			<div class="card-title">
                                              				 오더세트
                                            			</div>
                                            			
                                        			</div>
	                                       			 <div class="card-body" style="max-height: 300px; overflow-y: auto;">
			                                            <ul class="dropdown">
					                                        <c:forEach items="${orderSetList }" var="orderSet">
					                                             <li><a class="dropdown-item" href="#" data-groupOrderNo ="${orderSet.groupOrderNo}">${orderSet.groupOrderName}</a></li>
					                                        </c:forEach>
			                                            </ul>
	                                        		</div>
												</div>
												<div class="card custom-card" style="border: solid 1px rgb(229, 228, 228); margin-top: 0px;">
                                                    <div class="card-header justify-content-between">
                                                        <h7 class="fw-semibold">허리디스크</h7>
                                                        <div>
                                                            <a href="">
                                                                <i class="bi bi-plus-square float-end text-secondary fs-18"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <ul class="main-menu" style="list-style-type: none; padding: 0; margin: 0;">
                                                            <li><i class='bx bx-plus-medical'></i>관절통</li>
                                                            <li>
                                                           <svg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='currentColor' class='bi bi-capsule' viewBox='0 0 16 16'>
                                                            <path d='M1.828 8.9 8.9 1.827a4 4 0 1 1 5.657 5.657l-7.07 7.071A4 4 0 1 1 1.827 8.9Zm9.128.771 2.893-2.893a3 3 0 1 0-4.243-4.242L6.713 5.429z'/>
                                                            </svg> 에포리스정</li>
                                                        </ul>
                                                    </div>
                                                </div>
											</div>

										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					</div>
				</div>
				<!-- <div class="col-xxl-2 col-xl-12"> -->

			</div>
			<!-- End::row-1 -->

		</div>


    <script src="${pageContext.request.contextPath }/resources/assets/libs/dragula/dragula.min.js"></script>
       <!-- Internal Task  JS -->
       <script src="${pageContext.request.contextPath }/resources/assets/js/task-kanban-board.js"></script>
    
    <!-- Select2 Cdn -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Internal Select-2.js -->
    <script src="${pageContext.request.contextPath }/resources/assets/js/select2.js"></script>
    
    
 


</body>
<script type="text/javascript">


$(function() {
	
	//모달창 select2 오류 해결
	$('#bodyPartList, #bodyPartList2').select2({
		dropdownParent: $('#requestRadiationModal')    
	});
	$('#bodyPartList2').select2({
		dropdownParent: $('#requestPTModal')    
	});
	
	//현재 날짜, 시간 출력
	// 현재 날짜와 시간을 가져오기 위해 Date 객체 생성
	var now = new Date();
	
	// 연, 월, 일, 시, 분을 가져오기
	var year = now.getFullYear();
	var month = addZero(now.getMonth() + 1); // 월은 0부터 시작하므로 1을 더함
	var day = addZero(now.getDate());
	var hours = addZero(now.getHours());
	var minutes = addZero(now.getMinutes());
	
	// 출력을 위한 포맷 지정
	var formattedDateTime = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes;
	
	// 현재 날짜와 시간을 출력
	console.log("현재 시간: " + formattedDateTime);
	$("#currentTime").html(formattedDateTime);
	
	// 0을 추가하여 한 자리 숫자를 두 자리 숫자로 변환하는 함수
	function addZero(number) {
	    return (number < 10 ? '0' : '') + number;
	}

    //환자정보미리보기
    var previewLoc = $("#previewLoc");
    var previewDoctor = $("#previewDoctor");
    var previewMemName = $("#previewMemName");
    var previewMemGender = $("#previewMemGender");
    var previewMemAge = $("#previewMemAge");
    var previewMemRegno1 = $("#previewMemRegno1");
    var previewMemTel = $("#previewMemTel");
    
    //진료시작버튼
    var startChart = $("#startChart");
    
    var chartPatientName=$('#chartPatientName');
    var chartPatientGender=$('#chartPatientGender');
    var chartPatientAge=$('#chartPatientAge');
    var chartPatientRegno1=$('#chartPatientRegno1');

    //방사선요청
    var radiationSendBtn =$("#radiationSendBtn");
    var sendPatntNo="";			//환자번호
    var sendReceiptNo="";		//접수번호
    
    //파일등록
	var chartFile = $("#chartFile"); 
	var imgForm = $("#imgForm");
    
    //환자 미리보기 화면 띄우기
    function getWaitingList(){
    $.ajax({
        url: '/doctor/getWatingList', // 서버의 엔드포인트 URL을 여기에 입력
        type: 'GET',
        dataType: 'json', // 서버에서 응답으로 JSON을 사용하는 경우
        success: function(data) {
        	
        	//처음 프리뷰 화면에 첫번째 환자 정보 일단 띄우기
        	previewLoc.text(data[0].codeName);	//진료실이름
        	previewMemName.text(data[0].memName); //환자이름
        	previewMemGender.text(data[0].memGender); //환자성별
        	previewMemAge.text(data[0].memAge); //환자나이
        	previewMemRegno1.text(data[0].memRegno1); //환자나이
        	previewMemTel.text(data[0].memTel); //환자나이
        	
        	
            // 서버에서 받은 데이터를 처리하여 HTML 업데이트
            var html = '';
            $.each(data, function(index, item) {
                html += '<div class="card custom-card hrm-main-card primary">';
                html += '    <div class="card-header" style="padding: 4%;">';
                html += '        <h8 class="fw-semibold mt-1" style="padding: -10%;">' + item.codeName + '</h8>';
                html += '    </div>';
                html += '    <div class="card-body">';
                html += '        <div class="d-flex align-items-top">';
                html += '            <div class="me-3">';
                html += '                <span class="avatar bg-primary"> <i class="ri-team-line fs-18"></i></span>';
                html += '            </div>';
                html += '            <div class="row">';
                html += '                <h6 class="fw-semibold mt-1">';
                html += '                    <a href="#" id="watingMemName" data-memNo="'+item.memNo+'">' + item.memName + '</a>';
                html += '                    <span class="badge bg-secondary-transparent" style="float: right;">' + item.ccodeName + '</span>';
                html += '                </h6>';
                html += '                <div>';
                html += '                    <span class="fs-12 mb-0">' + item.memGender + ', ' + item.memAge + '세</span>';
                html += '                </div>';
                html += '            </div>';
                html += '        </div>';
                html += '    </div>';
                html += '</div>';
            });
            // HTML 업데이트
            $('#waitingList').html(html);
        },
        error: function(xhr, status, error) {
            console.error(xhr.responseText); // 에러 처리
        }
    });
    }
 // 페이지 로드 후 처음 한 번 요청을 실행
    getWaitingList();

    // 3초마다 비동기 요청 반복 실행
//     setInterval(getWaitingList, 10000);


	// 환자 클릭시 미리보기 정보 담기
     $('body').on('click','#watingMemName',function(event){
    	 
    	event.preventDefault();
    	
    	$('#previewPatient').css('display','block');
    	$('#chartView').css('display','none');
    	
    	
    	var memNo = $(this).attr('data-memNo');
    	
    	$.ajax({
   		 	url: '/doctor/patientPreview', // 서버의 엔드포인트 URL을 여기에 입력
   	        type: 'POST',
   	     	contentType: 'application/json',
   	        dataType: 'json', // 서버에서 응답으로 JSON을 사용하는 경우
   	     	data: JSON.stringify({ memNo: memNo }),
   	     	beforeSend: function(xhr) {
   	     	   // CSRF 토큰 헤더에 추가
                xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"), $("meta[name='_csrf']").attr("content"));
     		},

   	        success: function(data) {
   	        	
   	     	previewLoc.text(data.codeName);	//진료실이름
        	previewMemName.text(data.memName); //환자이름
        	previewMemGender.text(data.memGender); //환자성별
        	previewMemAge.text(data.memAge); //환자나이
        	previewMemRegno1.text(data.memRegno1); //환자나이
        	previewMemTel.text(data.memTel); //환자나이

        	
        	startChart.attr('data-memNo', memNo); //버튼에 memNo 담아서 진료차트 열게 하기

        	
   	        }, error : function(){console.log("에러발생")}
   		})
    	
    })
    
    // 진료시작시 차트 열어서 환자기본정보 담아서 진료차트 비동기로 띄우기
     $('body').on('click','#startChart',function(event){
    	 
    	event.preventDefault();
    	
    	var memNo = $(this).attr('data-memNo');
    	
    	$('#previewPatient').css('display','none');
    	$('#chartView').css('display','block');
    	
    	//차트안에 환자이름
     	$.ajax({
   		 	url: '/doctor/patientPreview', 
   	        type: 'POST',
   	     	contentType: 'application/json',
   	        dataType: 'json', // 서버에서 응답으로 JSON을 사용하는 경우
   	     	data: JSON.stringify({ memNo: memNo }),
   	     	beforeSend: function(xhr) {
   	     	   // CSRF 토큰 헤더에 추가
	            xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"), $("meta[name='_csrf']").attr("content"));
	     	},

   	        success: function(data) {
   	        	
   	        chartPatientName.text(data.memName); //환자이름
   	    	chartPatientGender.text(data.memGender); //환자성별
   	    	chartPatientAge.text(data.memAge); //환자나이
   	    	chartPatientRegno1.text(data.memRegno1); //환자나이
   	    	//차트내에서 쓰일 변수 담기
   	    	sendPatntNo = data.patntNo;
   	    	sendReceiptNo = data.receiptNo;
   	        }
   		})
   		
   		//차트안에 지난진료이력
   		 $.ajax({
   		 	url: '/doctor/patientChart', 
   	        type: 'POST',
   	     	contentType: 'application/json',
   	        dataType: 'json', // 서버에서 응답으로 JSON을 사용하는 경우
   	     	data: JSON.stringify({ memNo: memNo }),
   	     	beforeSend: function(xhr) {
   	     	   // CSRF 토큰 헤더에 추가
                xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"), $("meta[name='_csrf']").attr("content"));
     		},

   	        success: function(data) {
   	        	
   	        	var chartList = data.chartList;
   	        	var diseaseMap = data.diseaseMap;
   	        	var medicineMap = data.medicineMap;
   	        	var ptMap = data.ptMap;
   	        	
    	        // 서버에서 받은 데이터를 처리하여 HTML 업데이트
   	            var html = '';
   	            $.each(chartList, function(index, item) {
   	            	
   	            	html += "        <div class='accordion-item mb-2'>";
   	            	html += "            <h2 class='accordion-header' id='headingleftOne" + index + "'>";
   	            	html += "        		<button class='accordion-button' type='button' data-bs-toggle='collapse' data-bs-target='#collapseleftOne" + index + "' aria-expanded='true' aria-controls='collapseleftOne" + index + "'>" + item.chartDate + "</button>";
   	            	html += "            </h2>";
   	            	html += "    		<div id='collapseleftOne" + index + "' class='accordion-collapse collapse' aria-labelledby='headingleftOne" + index + "' data-bs-parent='#accordioniconLeftExample'>";
   	            	html += "                <div class='accordion-body'>";
   	            	html += "                    <div>";
   	            	html += "                        <span class='badge rounded-pill bg-secondary-transparent'>진료기록</span><br/>";
   	            	html += "						<i class='bi bi-clipboard2-pulse'></i>"				
   	            	html += "                        "+item.chartRecord;
   	            	html += "                    </div>";
   	            $.each( diseaseMap[item.chartNo], function(index1, item1) {
   	            	if(index1==0){
   	            		html += "                    <div>";
	   	            	html += "                        <span class='badge rounded-pill bg-danger-transparent'>주상병</span><br/>";
	   	            	html += "						<i class='bx bx-plus-medical'></i>";
	   	            	html += "                        "+item1.disNameKr;
	   	            	html += "                    </div>";
	   	            	html += "                    <div>";
	   	            	html += "                        <span class='badge rounded-pill bg-danger-transparent'>부상병</span><br/>";
	   	            	html += "  					 </div>";
   	            	}
   	            	if(index1 != 0){
   	            		html += "                    <div>";
	   	            	html += "						<i class='bx bx-plus-medical'></i>";
	   	            	html += "                        "+item1.disNameKr;
	   	            	html += "                    </div>";
   	            	}
   	            });
   	            	html += "                    <div>";
   	            	html += "                        <span class='badge rounded-pill bg-info-transparent'>처방</span><br/>";
   	            	
   	             $.each( medicineMap[item.chartNo], function(index2, item2) {
   	            	html +="<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='currentColor' class='bi bi-capsule' viewBox='0 0 16 16'>";
   	            	html +="<path d='M1.828 8.9 8.9 1.827a4 4 0 1 1 5.657 5.657l-7.07 7.071A4 4 0 1 1 1.827 8.9Zm9.128.771 2.893-2.893a3 3 0 1 0-4.243-4.242L6.713 5.429z'/>";
   	            	html +="</svg>";
   	            	html +=item2.mdcinName +"<br/>";
   	             });
	   	          $.each( ptMap[item.chartNo], function(index3, item3) {
	 	            	html +="<svg  xmlns='http://www.w3.org/2000/svg'  width='16'  height='16'  viewBox='0 0 24 24'  fill='none'  stroke='currentColor'  stroke-width='2'  stroke-linecap='round'  stroke-linejoin='round'  class='icon icon-tabler icons-tabler-outline icon-tabler-physotherapist'>";
	 	            	html +="<path stroke='none' d='M0 0h24v24H0z' fill='none'/>";
	 	            	html +="<path d='M9 15l-1 -3l4 -2l4 1h3.5' /><path d='M4 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0' /><path d='M12 6m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0' /><path d='M12 17v-7' /><path d='M8 20h7l1 -4l4 -2' /><path d='M18 20h3' /></svg>";
	 	            	html +=item3.codeName +"<br/>";
	 	             });
   	            	html += "                    </div>";
   	            	html += "                </div>";
   	            	html += "            </div>";
   	            	html += "        </div>";
   	            	
   	            });
//    	            HTML 업데이트
   	            $('#accordionprimaryborderExample').html(html);
	   	      // 클릭된 아코디언 열고 닫기
	   	         $('.accordion-button').on('click', function() {
	   	          var target = $(this).attr('data-bs-target');
	   	          var isOpen = $(target).hasClass('show');
	   	          if (isOpen) {
	   	        	$('.accordion-collapse').collapse('hide');
	   	          } else {
	   	              $('.accordion-collapse').collapse('hide');
	   	              $(target).collapse('show');
	   	          }
	   	      });
   	        	
   	        }
   		})
    });
    //차트조회 끝
	
	//방사선 검사요청
    radiationSendBtn.on("click", function(){
    	$("#patntNo").val(sendPatntNo);		//환자번호 담기
    	$("#receiptNo").val(sendReceiptNo); //접수번호 담기

    	$("#orderRadiation").submit();
    });
	
	//물리치료 검사 요청
	var checkedPt = [];
	var checkedCheckboxes;
	var selectPt=[];
	
	var selectedOptions;
	var selectedbodyPart = [];
	var selectBody="";
	$('#ptBtn').on("click", function(){
		
		//체크된 치료방법 담기
		checkedCheckboxes = document.querySelectorAll('input[name="ptSelect"]:checked');
		checkedCheckboxes.forEach(function(checkbox) {
			selectPt.push(checkbox.value)	//코드로 담긴 치료방법
			if(checkbox.value=='OD003'){
				checkbox.value='온열치료';
			}else if(checkbox.value=='OD008'){
				checkbox.value='초음파치료';
			}else if(checkbox.value=='OD009'){
				checkbox.value='충격파치료';
			}
			checkedPt.push(checkbox.value);	//한글로 담긴 치료방법
			
		});
		
		//선택된 치료부위 담기		
		selectedOptions = document.querySelectorAll('#bodyPartList2 option:checked');
		selectedOptions.forEach(function(option, index) {
			selectBody += option.value; //코드로 담긴 바디파트
			  if (index < selectedOptions.length - 1) {
			        selectBody += ',';
			    }
			if(option.value=='B001'){
				option.value='어깨';
			}else if(option.value=='B002'){
				option.value='팔';
			}else if(option.value=='B003'){
				option.value='손목';
			}else if(option.value=='B004'){
				option.value='엄지';
			}else if(option.value=='B005'){
				option.value='손가락';
			}else if(option.value=='B006'){
				option.value='고관절';
			}else if(option.value=='B007'){
				option.value='무릎';
			}else if(option.value=='B008'){
				option.value='발목';
			}else if(option.value=='B009'){
				option.value='경추';
			}else if(option.value=='B010'){
				option.value='흉추';
			}else if(option.value=='B011'){
				option.value='요추';
			}else if(option.value=='B012'){
				option.value='엉치';
			}else if(option.value=='B013'){
				option.value='꼬리뼈';
			}
			
			selectedbodyPart.push(option.value);	//한글로 담긴 바디파트
		});
		
		$('#selectedbodyPart').text(selectedbodyPart);
		$('#selectedPt').text(checkedPt);
		
		$("#requestPTModal").modal('hide');

	});
	
    //진단및 처방
    var pt;
	
	//진단 및 처방 검색 오토커밋
	let arr=[];
	var searchFlag=true;
	if(searchFlag){
	     $.ajax({
	            type : 'GET',
	            
	            url: '/doctor/diseaseSearch',
	            dataType : 'json',
	            success : function(data) {
	                // 서버에서 json 데이터 response 후 목록 추가
	                	for(var i=0 ; i<data.length; i++){
	                		arr[i]= data[i].disNo + " " + data[i].disNameKr;
	                	}
	            }
     	});
	}
	
	  //상병검색
	  var diseaseTab = document.querySelector('a[href="#searchDiseases"]');
	  diseaseTab.addEventListener('click', function (event) {
		searchFlag=true;
		$('#searchBox').val('');	
        $.ajax({
	            type : 'GET',
	            url: '/doctor/diseaseSearch',
	            dataType : 'json',
	            success : function(data) {
	                // 서버에서 json 데이터 response 후 목록 추가
	                	for(var i=0 ; i<data.length; i++){
	                		arr[i]= data[i].disNo + " " + data[i].disNameKr;
	                	}
	            }
        	});
		});
	 //약물검색
	
	 var medicineTab = document.querySelector('a[href="#searchMedicine"]');
	 medicineTab.addEventListener('click', function (event) {
		 searchFlag=false;
		 $('#searchBox').val('');
	        $.ajax({
		            type : 'GET',
		            url: '/doctor/medicineSearch',
		            dataType : 'json',
		            success : function(data) {
		                // 서버에서 json 데이터 response 후 목록 추가
		                	for(var i=0 ; i<data.length; i++){
		                		arr[i]=data[i].mdcinNo + " " + data[i].mdcinName;
		                	}
		            }
	        	});
			});
// 		var medicineList = [];	//처방약 리스트 배열
		var medicineSelect="";	//
	 	var medicineData ={};	//처방약을 제이슨형식으로 담은 데이터
	 	var medicineName="";	//처방약 이름 밸류값
	 	var medicineNo="";		//처방약 번호 키값
	 	var medicinePrescription = $('#medicinePrescription');
	 	
	 	var primaryDisease="";
	 	var primaryDiseaseData ={};	//주상병을 제이슨형식으로 담은 데이터
	 	var primaryDiseaseName="";		//주상병 이름 밸류값
	 	var primaryDiseaseNo="";		//주상병 번호 키값
	 	var primaryDiseaseArea = $('#primaryDisease');	//주상병 텍스트 입력 영역
	 	
	 	var secondaryDisease="";
		var secondaryDiseaseList = [];	//부상병 리스트 배열
	 	var secondaryDiseaseNoList=[];	//부상병 번호 배열
	 	var secondaryDiseaseData ={};	//부상병을 제이슨형식으로 담은 데이터
	 	var secondaryDiseaseName="";		//부상병 이름 밸류값
	 	var secondaryDiseaseNo="";		//부상병 번호 키값
	 	var secondaryDiseaseArea = $('#secondDisease');	//부상병 텍스트 입력 영역

	 	
	    $("#searchBox").autocomplete({
	    	maxShowItems: 5,
	       	source : arr,
	        select : function(event, ui) {	//검색 리스트에서 해당 필드 선택시 select 이벤트 발생
// 	            console.log(ui);
// 	            console.log(ui.item.label);
// 	            console.log(ui.item.value);
// 	            console.log(ui.item.test);

         	 
	            if (diseaseTab.classList.contains('active')) {

	            	//주상병 영역이 비어있을때 
		    	 	if (primaryDiseaseArea.next().length === 0){	
	            		var primaryDiseaseAreaHtml = "";	//주상병 입력 텍스트
	            		primaryDisease=ui.item.label;
	            		primaryDiseaseAreaHtml +="<div class='card custom-card m-2' style='display: inline-block; width:100%;'>"+primaryDisease+"<a href='#' id='deleteSel' style='display: inline-block; float: right; margin-right:10px;'>X</a></div>";
		            	primaryDiseaseArea.after(primaryDiseaseAreaHtml);
		            	
		            	$('#searchBox').val('');
		            	
	            	}else{									//부상병 영역에 추가
		            	var secondaryDiseaseAreaHtml ="";	//부상병입력 텍스트
		            	secondaryDisease = ui.item.label;	//부상병 입력
	            		secondaryDiseaseAreaHtml +="<div class='card custom-card m-2' style='display: inline-block; width:100%;'>"+secondaryDisease+"<a href='#' id='deleteSel' style='display: inline-block; float: right; margin-right:10px;'>X</a></div>";
	            		secondaryDiseaseArea.after(secondaryDiseaseAreaHtml);
	            		$('#searchBox').val('');
	            	}
		            
	            }else if(medicineTab.classList.contains('active')){
	            	var medicineAreaHtml = "";
	            	medicineSelect=ui.item.label;
					medicineAreaHtml +="<div class='card custom-card m-2' style='display: inline-block; width:100%;'>"+medicineSelect+"<a href='#' id='deleteSel' style='display: inline-block; float: right; margin-right:10px;'>X</a></div>";
	            	medicinePrescription.after(medicineAreaHtml);
					$('#searchBox').val('');
	            }
	        },
	        focus : function(event, ui) {	//한글 오류 방지
	            return false;
	        },
	        minLength : 1,
	        autoFocus : true,
	        classes : {
	            'ui-autocomplete': 'highlight'
	        },
	        delay : 500,
	        position : { my : 'right top', at : 'right bottom' },
	        close : function(event) {
	            console.log(event);
	        }
	  });
	 	
		//선택항목 삭제
		
		document.addEventListener('click', function(event) {
		    if (event.target.id === 'deleteSel') {
		        event.preventDefault(); // 기본 동작 방지
		        console.log("삭제!!!!!!");
		        var parentDiv = event.target.closest('.card'); // 클릭된 "X" 버튼의 부모 요소인 div.card를 찾습니다.
		        parentDiv.remove(); // 부모 요소를 삭제합니다.
		    }
		});
	  
	//진료완료버튼을 눌러서 진료차트 생성
	var medicineNoList =[]; //처방약번호
	let chartFiles = [];	// 사진첨부 시 저장할 파일 공간
	
	$("#insertChartBtn").on("click", function() {
		
			//진료차트 테이블
			var chartRecord = $("#chartRecord").val(); //진료기록
			var receiptNo = sendReceiptNo;	//접수번호
			var patntNo = sendPatntNo; //환자번호//진단내역 테이블
			//주상병
			var primaryDiseaseSend = $("#primaryDisease").next("div").text().trim();	//주상병 번호와 이름
			primaryDiseaseName = primaryDiseaseSend.substring(primaryDiseaseSend.indexOf(' ')+1); // 주상병 이름
			primaryDiseaseNo = primaryDiseaseSend.substring(0, primaryDiseaseSend.indexOf(' ')); // 주상병 번호
		    primaryDiseaseData[primaryDiseaseNo]=primaryDiseaseName;	// JSON 형식의 데이터에 키와 값을 추가
			//부상병
			var secondaryDiseaseSend = [];
		    var secondaryDiseaseSel="";
			var divCountDisease = $("#secondDisease").siblings("div").length;
		    
		    for(var i=0; i<divCountDisease; i++){
		    	secondaryDiseaseSel = $("#secondDisease").nextAll("div").eq(i).text().trim()
				secondaryDiseaseSend.push(secondaryDiseaseSel);	//부상병 번호와 이름
				secondaryDiseaseName = secondaryDiseaseSel.substring(secondaryDiseaseSel.indexOf(' ')+1); // 부상병 이름
				secondaryDiseaseNo = secondaryDiseaseSel.substring(0, secondaryDiseaseSel.indexOf(' ')); // 부상병 번호
		 		secondaryDiseaseNoList.push(secondaryDiseaseNo); //부상병번호 배열형식(오더세트등록에서 쓰임)
		 		secondaryDiseaseData[secondaryDiseaseNo]=secondaryDiseaseName;  // JSON 형식의 데이터에 키와 값을 추가
		    }
			
			//오더테이블
			//처방약오더
			var medicineSend=[];
			
		    var medicineSel="";
			var divCountMedicine = $("#medicinePrescription").siblings("div").length;
		    
		    for(var i=0; i<divCountMedicine; i++){
		    	medicineSel = $("#medicinePrescription").nextAll("div").eq(i).text().trim()
				medicineSend.push(medicineSel);	//부상병 번호와 이름
					medicineName = medicineSel.substring(medicineSel.indexOf(' ')+1); // 부상병 이름
					medicineNo = medicineSel.substring(0, medicineSel.indexOf(' ')); // 부상병 번호
					medicineNoList.push(medicineNo); //부상병번호 배열형식(오더세트등록에서 쓰임)
		 		medicineData[medicineNo]=medicineName;  // JSON 형식의 데이터에 키와 값을 추가
		    }
				console.log(medicineNoList);
			
			
			//물리치료 오더
			selectPt; //물리치료 방법(OD003, OD008, OD009)
			selectBody; //물리치료 부위(여러개)
// 			$('#chartFile').each(function() {
// 			    let inputFiles = $('#chartFile').prop('files');
// 			    if (inputFiles.length > 0) {
// 			        for (let i = 0; i < inputFiles.length; i++) {
// 			            files.push(inputFiles[i]);
// 			        }
// 			    }
// 			});
			
			console.log(chartFiles);
			
			var formData = new FormData();
			formData.append("chartRecord", chartRecord);
			formData.append("receiptNo", receiptNo);
			formData.append("patntNo", patntNo);
			formData.append("primaryDiseaseNo", primaryDiseaseNo);
			formData.append("secondaryDiseaseNoList", secondaryDiseaseNoList);
			formData.append("medicineNoList", medicineNoList);
			formData.append("selectPt", selectPt);
			formData.append("selectBody", selectBody);
			for(var i = 0; i < chartFiles.length; i++){
				formData.append("chartFile", chartFiles[i]);
			}

			
		 	$.ajax({
	   		 	url: '/doctor/insertChart', 
	   	        type: 'POST',
	   	     	contentType: false,
	   	     	processData: false,
	   	        dataType: 'text', 
	   	     	data: formData,
	   	     	beforeSend: function(xhr) {
	             // CSRF 토큰 헤더에 추가
                    xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"), $("meta[name='_csrf']").attr("content"));
         		},

	   	        success: function(res) {
	   	        	//차트넘버가져오기
					location.href="/doctor/mainChart";
					
	   	        }
	   		});
		});
	
	//오더세트 등록
	var groupOrderName = ""; 	//오더세트 명
	$("#createOrderName").on("click", function(){
		groupOrderName= $("#orderName").val(); //그룹오더 이름
		
		//진단내역 테이블
		//주상병
		var primaryDiseaseSend = $("#primaryDisease").next("div").text().trim();	//주상병 번호와 이름
		primaryDiseaseName = primaryDiseaseSend.substring(primaryDiseaseSend.indexOf(' ')+1); // 주상병 이름
		primaryDiseaseNo = primaryDiseaseSend.substring(0, primaryDiseaseSend.indexOf(' ')); // 주상병 번호
	    primaryDiseaseData[primaryDiseaseNo]=primaryDiseaseName;	// JSON 형식의 데이터에 키와 값을 추가
		//부상병
		var secondaryDiseaseSend = [];
	    var secondaryDiseaseSel="";
		var divCountDisease = $("#secondDisease").siblings("div").length;
	    
	    for(var i=0; i<divCountDisease; i++){
	    	secondaryDiseaseSel = $("#secondDisease").nextAll("div").eq(i).text().trim()
			secondaryDiseaseSend.push(secondaryDiseaseSel);	//부상병 번호와 이름
			secondaryDiseaseName = secondaryDiseaseSel.substring(secondaryDiseaseSel.indexOf(' ')+1); // 부상병 이름
			secondaryDiseaseNo = secondaryDiseaseSel.substring(0, secondaryDiseaseSel.indexOf(' ')); // 부상병 번호
	 		secondaryDiseaseNoList.push(secondaryDiseaseNo); //부상병번호 배열형식(오더세트등록에서 쓰임)
	 		secondaryDiseaseData[secondaryDiseaseNo]=secondaryDiseaseName;  // JSON 형식의 데이터에 키와 값을 추가
	    }
		
		//오더테이블
		//처방약오더
		var medicineSend=[];
		
	    var medicineSel="";
		var divCountMedicine = $("#medicinePrescription").siblings("div").length;
	    
	    for(var i=0; i<divCountMedicine; i++){
	    	medicineSel = $("#medicinePrescription").nextAll("div").eq(i).text().trim()
			medicineSend.push(medicineSel);	//부상병 번호와 이름
				medicineName = medicineSel.substring(medicineSel.indexOf(' ')+1); // 부상병 이름
				medicineNo = medicineSel.substring(0, medicineSel.indexOf(' ')); // 부상병 번호
				medicineNoList.push(medicineNo); //부상병번호 배열형식(오더세트등록에서 쓰임)
	 		medicineData[medicineNo]=medicineName;  // JSON 형식의 데이터에 키와 값을 추가
	    }
		
		var data = {
				groupOrderName : groupOrderName,
				primaryDiseaseNo : primaryDiseaseNo,	//주상병번호
				secondaryDiseaseNoList : secondaryDiseaseNoList,	//부상병번호 리스트
				medicineNoList : medicineNoList
		};
		
	 	$.ajax({
   		 	url: '/doctor/insertGroupOrder', // 서버의 엔드포인트 URL을 여기에 입력
   	        type: 'POST',
   	     	contentType: 'application/json',
   	        dataType: 'text', 
   	     	data: JSON.stringify(data),
   	     	beforeSend: function(xhr) {
   	     	   // CSRF 토큰 헤더에 추가
                xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"), $("meta[name='_csrf']").attr("content"));
     		},

   	        success: function(res) {
   				$("#closeModal").click();
   	        }
   		});
	});
	
	//오더세트 조회
	var dropdownItems = document.querySelectorAll('.dropdown-item');
	var groupOrderNo="";
	// 각각의 요소에 대해 클릭 이벤트를 추가
	 // li 요소를 클릭할 때마다 색깔로 표시
    $('.dropdown-item').on('click', function() {
        // 모든 li 요소의 클래스를 초기화
        $('.dropdown-item').removeClass('active');
        // 현재 클릭한 li 요소에 active 클래스 추가
        $(this).addClass('active');
    });
	
	dropdownItems.forEach(function(item) {
	    item.addEventListener('click', function(event) {
	        event.preventDefault(); // 기본 동작 방지
	        
	        primaryDiseaseArea.nextAll().remove(); //영역 다 비우기
	        secondaryDiseaseArea.nextAll().remove(); //영역 다 비우기
	        medicinePrescription.nextAll().remove(); //영역 다 비우기

	        // 클릭된 요소에서 그룹오더 넘버 가져오기
	        groupOrderNo = this.getAttribute('data-groupOrderNo');
	        
		 	$.ajax({
	   		 	url: '/orderSet/detail', 
	   	        type: 'POST',
	   	     	contentType: 'application/json',
	   	        dataType: 'json', 
	   	     	data: JSON.stringify({groupOrderNo : groupOrderNo}),
	   	     	beforeSend: function(xhr) {
	             // CSRF 토큰 헤더에 추가
                    xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"), $("meta[name='_csrf']").attr("content"));
         		},
	   	        success: function(res) {
	   	        	var orderSetName = res.orderSetName;
	   	        	var diseaseList = res.orderSetDiseaseList;
	   	        	var medicineList = res.orderSetMedicineList;
	   	        	
	   	        	console.log(diseaseList);
	   	        	
	   	        	$.each(diseaseList, function(index, item) {
	   	        		var getPrimaryDiseaseAreaHtml="";
	   	        		var getSecondaryDiseaseAreaHtml="";
	   	        		
		   	        	if(index==0){
			   	        	getPrimaryDiseaseAreaHtml +="<div class='card custom-card m-2' style='display: inline-block; width:100%;'>"+item.disNo +" "+item.disNameKr+"<a href='#' id='deleteSel' style='display: inline-block; float: right; margin-right:10px;'>X</a></div>";
			   	        	primaryDiseaseArea.after(getPrimaryDiseaseAreaHtml);
		   	        	}
		   	        	if(index!=0){
			   	        	getSecondaryDiseaseAreaHtml +="<div class='card custom-card m-2' style='display: inline-block; width:100%;'>"+item.disNo +" "+item.disNameKr+"<a href='#' id='deleteSel' style='display: inline-block; float: right; margin-right:10px;'>X</a></div>";
		            		secondaryDiseaseArea.after(getSecondaryDiseaseAreaHtml);
		   	        	}
	   	        	});
	   	        	$.each(medicineList, function(index, item) {
	   	        		var getMedicineAreaHtml="";
						getMedicineAreaHtml +="<div class='card custom-card m-2' style='display: inline-block; width:100%;'>"+item.mdcinNo +" "+item.mdcinName+"<a href='#' id='deleteSel' style='display: inline-block; float: right; margin-right:10px;'>X</a></div>";
						medicinePrescription.after(getMedicineAreaHtml);
	   	        	});
	   	        	
	   	         $('#insert-orderGroup').on('show.bs.modal', function (e) {
	 	            // 모달이 열릴 때 실행되는 부분
	 	            $('#orderName').val(orderSetName);
	 	        });
					
	   	        }
	   		});
	        
	    });
	});
	
	//파일등록
	//Open 파일을 변경했을 때 발동 (파일을 선택했을때)
	chartFile.on("change", function (event) {
		console.log(event);
		
		var files = event.target.files;
		
		for (var i = 0; i < files.length; i++) {
			var file = files[i];
// 			console.log("이거 찍히는 파일 이름" + file.name); // 파일 체크
			var formData = new FormData();
			formData.append("file", file);
			
			chartFiles.push(file);
			
			
			$.ajax({
				url : "/file/uploadAjaxChart",
				type : "post",
				data : formData,
				//받고싶은 데이터 타입
				dataType : "text",
				//직렬화방지
				processData : false,
				//enc타입 활용하기 위해
				contentType : false,
				success: function(data) {
					var idx = data.indexOf("_") + 1;
					console.log("데이터값 : " +data);
					var fileName =data.substr(idx);
					console.log("이거 파일이름 값" + fileName);
					
					var str = "";
					if (checkImageType(data)) {	//이미지면 이미지태그를 이용하여 출력
						str += "<div style='position: relative; background-color: black; display: inline-block;'>";
						str += "    <a href='/file/displayFileChart?fileName=" + data +"' data-value='" +fileName+"'>";
						str += "        <img src='/file/displayFileChart?fileName=" + getThumbnailName(data) +"' style='width: 100px; height: 100px;'>"; 
						str += "    </a>";
						str += "    <span style='position: absolute; top: 5px; right: 5px; color: white; cursor: pointer;'>X</span>";
						str += "</div>";
					}else {
						str += "<div style='position: relative; background-color: black; display: inline-block;'>";
						str += "    <a href='/file/displayFileChart?fileName=" + data +"' data-value='" +fileName+"'>";
						str += "        <img src='/file/displayFileChart?fileName=" + getOriginalName(data) +"' style='width: 100px; height: 100px;'>"; 
						str += "    </a>";
						str += "    <span style='position: absolute; top: 5px; right: 5px; color: white; cursor: pointer;'>X</span>";
						str += "</div>";
						
					}
					
					$(".uploadedList").append(str);
				}
			});
		}
	});
	
	//업로드 한 파일의 'X'를 클릭했을때
	$(".uploadedList").on("click", "span", function () {
		$(this).parent("div").remove();
		var selFileName = $(this).siblings("a").data("value");
		console.log("선택한 파일이름 " +selFileName );
		for(var i=0; i<chartFiles.length; i++){
			console.log("이거 파일차트이름들"+ chartFiles[i].name);
			if( String(chartFiles[i].name) === String(selFileName)){
				console.log("선택한 파일이름 " +selFileName );
				  chartFiles.splice(i, 1); // 해당 파일을 배열에서 삭제
				  break;
			}
		}
// 		console.log("이거임 " + $(this).siblings("a").data("value"));
		
		console.log("이게 차트파일 " + chartFiles);
		
	});
	
	// 파일명 추출
	function getOriginalName(fileName) {
		if (checkImageType(fileName)) {
			return;
		}
		var idx = fileName.indexOf("_") + 1;
		return fileName.substr(idx);
	}
	
	//임시 파일로 썸네일 이미지 만들기(폴더에서 s_가 붙은 썸네일을 찾아옴)
	function getThumbnailName(fileName) {
		var front = fileName.substr(0, 12); // /2024/03/06/ 폴더
		var end  = fileName.substr(12); //뒤 파일명
		
		console.log("front : " + front);
		console.log("end : " + end);
		
		return front + "s_" +end;
	}
	
	// 이미지 파일인지 확인
	function checkImageType(fileName) {
		
		//정규 표현식을 사용하여 이미지 파일 확장자를 나타내는 패턴을 정의한다.
		// /와 /i 사이에 있는 jpg|gif|png|jpeg는 이미지 파일 확장자를 나타내며, 
		// i 플래그는 대소문자를 구분하지 않도록 설정
		var pattern = /jpg|gif|png|jpeg/i;
		
		return fileName.match(pattern); // 패턴과 일치하면 true(이미지구나?)
	}
	
	$("#collaborationBtn").on("click", function(){
		
		var collaboPatientName  = $("#collabo_patientName");	//협진요청할 환자이름
		var collaboPatientBirth = $("#collabo_patientBirth");	//협진요청할 환자 생년월일
		var collaboGender = $("#collabo_gender");	//협진요청할 환자 성별
		var collaboDisease = $("#collabo_disease"); //주상병
		
		var selectDoctor = $("#selectDoctor");	//요청대상의사
		var collaboComment = $("#collabo_comment"); // 요청 메모
		var collaboRequestBtn = $("#collaboRequestBtn"); //협진요청 전송버튼
		
		//협진요청번호에 환자 기본정보 셋팅
		
		collaboPatientName.text(chartPatientName.text() + " ");
		collaboPatientBirth.text("("+chartPatientRegno1.text()+") ");
		collaboGender.text(chartPatientGender.text());
		var reqDisease = $("#primaryDisease").next("div").text().trim().slice(0,-1)
		collaboDisease.text(reqDisease);
		sendPatntNo;//환자번호
		var respDoctor = selectDoctor.val();	//의사 직원번호
		var comment = reqDisease +" " + collaboComment.val(); //메모
		
		let data = {
				patntNo : sendPatntNo,
				empNo : respDoctor,
				collaboReqContent : comment
		};
		collaboRequestBtn.on("click", function(){
			
			$.ajax({
				url : "/doctor/reqCollaboration",
				type : "post",
				data :JSON.stringify(data),
				contentType : "application/json;charset=utf-8",
				success : function(res){
					console.log(res);
	// 					that.closest('tr').remove();
	//                     $('#infoToast').toast('show');
	//                     reloadDataTable();
	//                     $('#vacation-table').DataTable().ajax.reload();
	// 					ws.send("collaborationResult#"+empNo+"#agree#"+res);
					console.log("요청성공!");
				}
			});
			
			
		
		});
		

		
		
		
		
	});
	
	
});
</script>


</html>