package kr.or.ddit.service.impl;

import java.util.List;

import javax.inject.Inject;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import kr.or.ddit.ServiceResult;
import kr.or.ddit.mapper.IVacationMapper;
import kr.or.ddit.service.IVacationService;
import kr.or.ddit.vo.VacationRequestVO;

@Service
public class VacationServiceImpl implements IVacationService {
	
	@Inject
	private IVacationMapper vacationMapper;
	
	@Override
	public List<VacationRequestVO> getVacationRequestMine(int memNo) {
		List<VacationRequestVO> vrv = vacationMapper.getVacationRequestMine(memNo);
		for (VacationRequestVO v : vrv) {
			String[] target = v.getVacationStartDate().substring(0,v.getVacationStartDate().indexOf(" ")).split("-");
			v.setVacationStartDate(String.format("%s년 %s월 %s일", target[0], target[1], target[2]));
			target = v.getVacationEndDate().substring(0,v.getVacationEndDate().indexOf(" ")).split("-");
			v.setVacationEndDate(String.format("%s년 %s월 %s일", target[0], target[1], target[2]));
			target = v.getVacationRequestDate().substring(0,v.getVacationRequestDate().indexOf(" ")).split("-");
			v.setVacationRequestDate(String.format("%s년 %s월 %s일", target[0], target[1], target[2]));
		}
		return vrv;
		
	}

	@Override
	public ServiceResult vacationRequest(VacationRequestVO vacationVO) {
		int res = vacationMapper.vacationRequest(vacationVO);
		if(res > 0) return ServiceResult.OK;
		if(res == 0) return ServiceResult.FAILED;
		return null;
	}

	@Override
	public List<VacationRequestVO> getVacationReqList() {
		return vacationMapper.getVacationReqList();
	}


	@Override
	public ServiceResult agreeRequest(VacationRequestVO reqVO) {
		int reqNo = reqVO.getVacationRequestNo();
		int empNo = reqVO.getEmpNo();
		// 요청 테이블 null -> Y 로 변경해주기
		int req1 = vacationMapper.updateRequest(reqNo);
		// 결과 테이블 남기기 ->
		int req2 = vacationMapper.insertAgreeResult(reqNo);
		// 알림 내역 테이블 남기기 ->
		int req3 = vacationMapper.insertAgreeNoti(empNo);
		// 실시간으로 알림 보내주기 ->
		
		
		
		if(req1 > 0 && req2 > 0 && req3 > 0 )return ServiceResult.OK;
		else return ServiceResult.FAILED;
	}

}
